
### Проект: **"Система бронювання ресурсів (наприклад, кімнат, обладнання)"**

**Опис проекту:** Створіть систему бронювання, де користувачі можуть резервувати ресурси, наприклад, кімнати чи обладнання. Це дозволить покрити всі перелічені теми з використанням реальних прикладів.

---

**План уроку:**

### 1. Вступ до проєкту

- Опис функціональності системи (користувачі, ресурси, бронювання).
- Демонстрація структури бази даних:
    - Користувачі (`Users`) – таблиця для зберігання інформації про користувачів.
    - Ресурси (`Resources`) – таблиця з даними про ресурси.
    - Бронювання (`Bookings`) – таблиця для зв'язку між користувачами та ресурсами (м2м).

---

### 2. Розширені можливості SQLAlchemy

#### **2.1 Події та колбеки**

- Напишіть колбек для автоматичного заповнення часу створення та оновлення записів.
- Приклад: автоматичне встановлення поля `created_at` та `updated_at`.

#### **2.2 Валідація даних**

- Використовуйте ORM-валидацію перед створенням або оновленням записів.
- Приклад: перевірка, щоб час початку бронювання не перевищував час закінчення.

#### **2.3 Зв'язки M2M та O2M**

- Реалізуйте:
    - O2M зв'язок між користувачами та бронюваннями.
    - M2M зв'язок між ресурсами та бронюваннями через асоціативну таблицю.

#### **2.4 Робота з транзакціями**

- Додайте транзакцію для процесу створення бронювання:
    - Перевірка доступності ресурсу.
    - Створення запису про бронювання.

---

### 3. Міграції схеми бази даних

#### **3.1 Створення та застосування міграцій**

- Додайте таблиці (`Users`, `Resources`, `Bookings`).
- Додайте індекси на ключові поля (наприклад, `user_id`, `resource_id`).

---

### 4. Практичний приклад міграції разом з Alembic

#### **4.1 Налаштування пакета Alembic**

- Додайте Alembic до проекту та налаштуйте `alembic.ini`.

#### **4.2 Створення міграцій**

- Приклад: додайте нове поле до таблиці `Bookings`, наприклад, `status` (pending/approved).

#### **4.3 Заповнення БД даними**

- Додайте початкові дані:
    - Кілька користувачів.
    - Ресурси для бронювання.
    - Попередні бронювання.




#   структура проекту:

```
project/
│
├── app/
│   ├── __init__.py         # Ініціалізація Flask/FastAPI
│   ├── config.py           # Налаштування проекту
│   ├── main.py             # Точка входу, створення застосунку
│   ├── models/             # SQLAlchemy моделі
│   │   ├── __init__.py     # Імпортує всі моделі
│   │   ├── user.py         # Модель користувача
│   │   ├── resource.py     # Модель ресурсу
│   │   ├── booking.py      # Модель бронювання
│   │
│   ├── schemas/            # Схеми для валідації (pydantic, marshmallow)
│   │   ├── __init__.py     # Імпортує всі схеми
│   │   ├── user_schema.py  # Схеми для користувачів
│   │   ├── booking_schema.py  # Схеми для бронювань
│   │
│   ├── services/           # Бізнес-логіка
│   │   ├── __init__.py     # Імпортує всі сервіси
│   │   ├── user_service.py # Сервіси для роботи з користувачами
│   │   ├── booking_service.py # Сервіси для бронювань
│   │
│   ├── repositories/       # Логіка роботи з базою даних
│   │   ├── __init__.py     # Імпортує всі репозиторії
│   │   ├── user_repo.py    # Репозиторій для користувачів
│   │   ├── booking_repo.py # Репозиторій для бронювань
│   │
│   ├── routes/             # Контролери (endpoints API)
│   │   ├── __init__.py     # Імпортує всі маршрути
│   │   ├── user_routes.py  # Роутери для користувачів
│   │   ├── booking_routes.py # Роутери для бронювань
│   │
│   ├── migrations/         # Міграції Alembic
│   │   ├── versions/       # Файли міграцій
│   │   ├── env.py          # Конфігурація Alembic
│   │   ├── script.py.mako  # Шаблон скриптів
│
├── tests/                  # Тести
│   ├── __init__.py         # Ініціалізація тестів
│   ├── test_users.py       # Тести для користувачів
│   ├── test_bookings.py    # Тести для бронювань
│
├── requirements.txt        # Залежності Python
├── README.md               # Документація проекту
```

---

### Пояснення структури:

1. **`models`** — SQLAlchemy моделі для опису структури бази даних (ORM).
2. **`schemas`** — Схеми для валідації вхідних та вихідних даних (наприклад, Pydantic/Marshmallow).
3. **`services`** — Бізнес-логіка, яка не залежить від API чи бази даних (наприклад, перевірка доступності ресурсу перед бронюванням).
4. **`repositories`** — Логіка роботи з базою даних, використовуючи SQLAlchemy (CRUD-операції).
5. **`routes`** — API-ендпоінти для обробки запитів (Flask або FastAPI).
6. **`migrations`** — Налаштування та файли Alembic для управління міграціями бази даних.
7. **`tests`** — Тести для перевірки логіки проекту (Unit та Integration тести).
8. **`config.py`** — Файл з конфігураціями (налаштування бази даних, ключі API тощо).

---

### Потік обробки запиту:

1. **Маршрут (`routes`)** отримує запит від користувача.
2. Викликає відповідний метод у **сервісі (`services`)**, який обробляє логіку.
3. Сервіс взаємодіє з базою даних через **репозиторій (`repositories`)**.
4. Результат повертається до маршруту, де формуються HTTP-відповіді.

---

Такий підхід дозволяє розділити логіку на зрозумілі модулі, що спрощує розвиток проекту.